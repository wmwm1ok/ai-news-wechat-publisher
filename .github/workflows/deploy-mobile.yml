name: Deploy Mobile Preview

on:
  workflow_run:
    workflows: ["AI Daily News Publisher"]
    types:
      - completed
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    # 只在主工作流成功时运行
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Download artifacts from main workflow
        uses: actions/download-artifact@v4
        with:
          name: news-output-${{ github.event.workflow_run.id }}
          path: output/
        continue-on-error: true
      
      - name: Generate mobile preview pages
        run: |
          mkdir -p docs
          
          # 复制基础预览页
          cp mobile-preview.html docs/index.html 2>/dev/null || true
          
          # 复制秀米预览页
          if [ -f docs/xiumi.html ]; then
            echo "✅ 秀米页面已存在"
          fi
          
          # 列出生成的文件
          ls -la output/ 2>/dev/null || echo "No output files yet"
      
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        if: github.ref == 'refs/heads/main'
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
          force_orphan: true
