<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="refresh" content="300">
    <title>AIæ—¥æŠ¥ - åœ¨çº¿ç¼–è¾‘å™¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Helvetica Neue', sans-serif;
            background: #f5f5f5;
            padding-bottom: 100px;
        }
        .header {
            background: linear-gradient(135deg, #1c5cff 0%, #00c6ff 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header h1 { font-size: 22px; margin-bottom: 5px; }
        .header .date { font-size: 13px; opacity: 0.9; }
        .header .count { font-size: 12px; margin-top: 5px; opacity: 0.8; }
        
        .action-bar {
            background: white;
            padding: 15px 20px;
            margin: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
        }
        .action-bar p {
            font-size: 13px;
            color: #666;
            margin-bottom: 12px;
            line-height: 1.6;
        }
        .btn {
            display: inline-block;
            background: #07c160;
            color: white;
            border: none;
            padding: 14px 40px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(7, 193, 96, 0.35);
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
        }
        .btn:active {
            transform: scale(0.96);
            box-shadow: 0 2px 8px rgba(7, 193, 96, 0.25);
        }
        .btn-secondary {
            background: #576b95;
            margin-left: 10px;
            box-shadow: 0 4px 12px rgba(87, 107, 149, 0.35);
        }
        .btn-secondary:active {
            box-shadow: 0 2px 8px rgba(87, 107, 149, 0.25);
        }
        
        .loading {
            text-align: center;
            padding: 50px 20px;
            color: #999;
        }
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #1c5cff;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
            vertical-align: middle;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .editor-container {
            background: white;
            margin: 0 15px 15px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .editor-toolbar {
            background: #f8f9fa;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            font-size: 13px;
            color: #666;
        }
        #rich-editor {
            padding: 20px;
            min-height: 400px;
            font-size: 15px;
            line-height: 1.8;
            color: #333;
            outline: none;
        }
        #rich-editor:focus {
            background: #fafafa;
        }
        
        .section-title {
            color: #1c5cff;
            font-size: 16px;
            font-weight: 600;
            margin: 25px 0 15px;
            padding: 8px 12px;
            background: #f0f7ff;
            border-radius: 6px;
            display: inline-block;
        }
        .article {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #1c5cff;
        }
        .article-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            line-height: 1.5;
        }
        .article-meta {
            font-size: 12px;
            color: #999;
            margin-bottom: 10px;
        }
        .article-summary {
            font-size: 14px;
            color: #555;
            line-height: 1.8;
        }
        
        .footer {
            text-align: center;
            padding: 30px 20px;
            color: #999;
            font-size: 12px;
        }
        
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 18px 32px;
            border-radius: 10px;
            font-size: 15px;
            display: none;
            z-index: 1000;
            text-align: center;
            max-width: 80%;
        }
        .toast.success { background: rgba(7, 193, 96, 0.95); }
        .toast.error { background: rgba(255, 77, 79, 0.95); }
        
        .tips {
            background: #fffbe6;
            border: 1px solid #ffe58f;
            padding: 12px 15px;
            margin: 15px;
            border-radius: 8px;
            font-size: 13px;
            color: #666;
        }
        .tips strong { color: #d48806; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¤– AI æ¯æ—¥å¿«æŠ¥</h1>
        <div class="date" id="current-date">åŠ è½½ä¸­...</div>
        <div class="count" id="article-count"></div>
    </div>
    
    <div class="action-bar" id="action-bar" style="display: none;">
        <p>ğŸ’¡ ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¤åˆ¶å…¨éƒ¨å†…å®¹<br>ç„¶ååœ¨å…¬ä¼—å·ç¼–è¾‘å™¨ä¸­ç²˜è´´å³å¯ä¿ç•™æ ¼å¼</p>
        <button class="btn" onclick="copyForWechat()">ğŸ“‹ å¤åˆ¶å…¨éƒ¨å†…å®¹</button>
    </div>
    
    <div class="tips" id="tips" style="display: none;">
        <strong>ğŸ“ ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
        1. ç‚¹å‡»ã€Œå¤åˆ¶å…¨éƒ¨å†…å®¹ã€æŒ‰é’®<br>
        2. å†…å®¹å·²å¤åˆ¶ï¼ˆå«æ ¼å¼ï¼‰<br>
        3. åˆ‡æ¢åˆ°å…¬ä¼—å·ç¼–è¾‘å™¨ç²˜è´´å³å¯
    </div>
    
    <div class="editor-container">
        <div class="editor-toolbar">
            ğŸ“„ ç¼–è¾‘åŒºï¼ˆå¯ç›´æ¥ä¿®æ”¹å†…å®¹ï¼‰
        </div>
        <div id="rich-editor">
            <div class="loading">æ­£åœ¨åŠ è½½å†…å®¹</div>
        </div>
    </div>
    
    <div class="footer">
        <p>AI æ¯æ—¥å¿«æŠ¥ Â· è‡ªåŠ¨ç”Ÿæˆ</p>
        <p style="margin-top: 8px; opacity: 0.7;">æ¯å¤© 8:00 æ›´æ–°</p>
    </div>
    
    <div class="toast" id="toast"></div>

    <script>
        let currentData = null;
        
        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                // å°è¯•ä»å¤šä¸ªä½ç½®åŠ è½½æ•°æ®
                const sources = [
                    './latest.json',
                    'latest.json',
                    './output/latest.json',
                    'output/latest.json'
                ];
                
                let data = null;
                for (const url of sources) {
                    try {
                        const response = await fetch(url + '?t=' + Date.now());
                        if (response.ok) {
                            data = await response.json();
                            console.log('âœ… ä»', url, 'åŠ è½½æˆåŠŸ');
                            break;
                        }
                    } catch (e) {
                        console.log('âŒ ä»', url, 'åŠ è½½å¤±è´¥');
                    }
                }
                
                if (!data) {
                    throw new Error('æ— æ³•åŠ è½½æ•°æ®');
                }
                
                currentData = data;
                renderContent(data);
                document.getElementById('action-bar').style.display = 'block';
                document.getElementById('tips').style.display = 'block';
            } catch (error) {
                console.error('åŠ è½½å¤±è´¥:', error);
                document.getElementById('rich-editor').innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #999;">
                        <p>âš ï¸ å†…å®¹åŠ è½½å¤±è´¥</p>
                        <p style="font-size: 14px; margin-top: 10px;">è¯·åˆ·æ–°é¡µé¢é‡è¯•</p>
                        <p style="font-size: 12px; margin-top: 20px; opacity: 0.7;">${error.message}</p>
                    </div>
                `;
            }
        }
        
        // æ¸²æŸ“å†…å®¹
        function renderContent(data) {
            // ä½¿ç”¨æ•°æ®ä¸­çš„æ—¥æœŸï¼ˆä¸åç«¯ä¸€è‡´ï¼‰
            document.getElementById('current-date').textContent = data.date;
            document.getElementById('article-count').textContent = `å…± ${data.count} æ¡ç²¾é€‰èµ„è®¯`;
            
            const editor = document.getElementById('rich-editor');
            
            // æŒ‰åˆ†ç±»åˆ†ç»„
            const sections = {};
            data.articles.forEach(article => {
                const section = article.section || 'å…¶ä»–';
                if (!sections[section]) {
                    sections[section] = [];
                }
                sections[section].push(article);
            });
            
            const SECTION_ORDER = [
                'äº§å“å‘å¸ƒä¸æ›´æ–°',
                'æŠ€æœ¯ä¸ç ”ç©¶',
                'æŠ•èèµ„ä¸å¹¶è´­',
                'æ”¿ç­–ä¸ç›‘ç®¡',
                'å…¶ä»–'
            ];
            
            const SECTION_COLORS = {
                'äº§å“å‘å¸ƒä¸æ›´æ–°': '#07c160',
                'æŠ€æœ¯ä¸ç ”ç©¶': '#1989fa',
                'æŠ•èèµ„ä¸å¹¶è´­': '#ff6b6b',
                'æ”¿ç­–ä¸ç›‘ç®¡': '#ff9f43',
                'å…¶ä»–': '#999999'
            };
            
            let html = `
<section style="max-width: 600px; margin: 0 auto; font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', sans-serif; line-height: 1.8;">
    
    <div style="text-align: center; padding: 30px 20px; background: linear-gradient(135deg, #1c5cff, #00c6ff); border-radius: 12px; margin-bottom: 20px;">
        <h1 style="color: white; margin: 0 0 10px; font-size: 24px;">ğŸ¤– AI æ¯æ—¥å¿«æŠ¥</h1>
        <p style="color: white; margin: 0; opacity: 0.9; font-size: 14px;">${data.date}</p>
    </div>
    
    <div style="background: #f0f7ff; border-left: 4px solid #1c5cff; padding: 15px; margin-bottom: 25px; border-radius: 0 8px 8px 0;">
        <p style="margin: 0; font-size: 14px; color: #333;">ğŸ“Œ æœ¬æœŸç²¾é€‰ ${data.count} æ¡ AI è¡Œä¸šèµ„è®¯</p>
    </div>
`;
            
            // æŒ‰å›ºå®šé¡ºåºæ¸²æŸ“åˆ†ç±»
            SECTION_ORDER.forEach(section => {
                if (!sections[section] || sections[section].length === 0) return;
                
                const color = SECTION_COLORS[section] || '#1c5cff';
                
                html += `
    <h2 style="color: ${color}; font-size: 16px; margin: 25px 0 15px; padding: 8px 12px; background: #f0f7ff; border-radius: 6px; display: inline-block;">${section}</h2>
`;
                
                sections[section].forEach(item => {
                    html += `
    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 3px solid ${color};">
        <h3 style="font-size: 15px; color: #333; margin: 0 0 8px; line-height: 1.5; font-weight: 600;">${item.company ? `<span style="color: ${color};">[${escapeHtml(item.company)}]</span> ` : ''}${escapeHtml(item.title)}</h3>
        ${item.source ? `<p style="font-size: 12px; color: #999; margin: 0 0 8px;">ğŸ“° ${escapeHtml(item.source)}</p>` : ''}
        <p style="font-size: 14px; color: #555; margin: 0; line-height: 1.8;">${escapeHtml(item.summary)}</p>
    </div>
`;
                });
            });
            
            // æ¸²æŸ“å…¶ä»–åˆ†ç±»
            Object.keys(sections).forEach(section => {
                if (SECTION_ORDER.includes(section)) return;
                
                const color = '#1c5cff';
                
                html += `
    <h2 style="color: ${color}; font-size: 16px; margin: 25px 0 15px; padding: 8px 12px; background: #f0f7ff; border-radius: 6px; display: inline-block;">${section}</h2>
`;
                
                sections[section].forEach(item => {
                    html += `
    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 12px; border-left: 3px solid ${color};">
        <h3 style="font-size: 15px; color: #333; margin: 0 0 8px; line-height: 1.5; font-weight: 600;">${item.company ? `<span style="color: ${color};">[${item.company}]</span> ` : ''}${escapeHtml(item.title)}</h3>
        ${item.source ? `<p style="font-size: 12px; color: #999; margin: 0 0 8px;">ğŸ“° ${escapeHtml(item.source)}</p>` : ''}
        <p style="font-size: 14px; color: #555; margin: 0; line-height: 1.8;">${escapeHtml(item.summary)}</p>
    </div>
`;
                });
            });
            
            html += `
    <div style="text-align: center; padding: 20px; margin-top: 30px; border-top: 1px solid #eee;">
        <p style="color: #999; font-size: 12px; margin: 0;">AI æ¯æ—¥å¿«æŠ¥ Â· ${data.date}</p>
    </div>
    
</section>`;
            
            editor.innerHTML = html;
        }
        
        function escapeHtml(str) {
            return String(str || '')
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;');
        }
        
        // å¤åˆ¶åˆ°å…¬ä¼—å·
        function copyForWechat() {
            const editor = document.getElementById('rich-editor');
            
            const range = document.createRange();
            range.selectNodeContents(editor);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            
            try {
                document.execCommand('copy');
                showToast('âœ… å·²å¤åˆ¶å…¨éƒ¨å†…å®¹ï¼\nè¯·æ‰“å¼€å…¬ä¼—å·åŠ©æ‰‹ç²˜è´´', 'success');
            } catch (err) {
                showToast('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
            }
            
            selection.removeAllRanges();
        }
        
        function showToast(message, type) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 2500);
        }
        
        // æ¯5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°æ•°æ®
        setInterval(loadData, 5 * 60 * 1000);
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
